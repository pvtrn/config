# ============================================
# Основные настройки
# ============================================

# Включить поддержку мыши
set -g mouse on

# 256 цветов
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# OSC52 clipboard support (для копирования через SSH в iTerm2)
set -g allow-passthrough on
set -g set-clipboard on

# Vi-style copy mode
setw -g mode-keys vi

# Copy mode bindings (vim-style)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Enter send -X copy-selection-and-cancel

# Mouse selection copies to clipboard automatically (via set-clipboard on)
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

# Начинать нумерацию окон с 1
set -g base-index 1
setw -g pane-base-index 1

# Перенумеровывать окна при закрытии
set -g renumber-windows on

# Увеличить историю
set -g history-limit 50000

# Быстрая реакция на escape
set -sg escape-time 0

# ============================================
# Prefix key - меняем на Ctrl+a (удобнее чем Ctrl+b)
# ============================================
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ============================================
# Дублирование хоткеев для русской раскладки
# ============================================

# c/с - новое окно
bind с new-window

# n/т - следующее окно
bind т next-window

# p/з - предыдущее окно
bind з previous-window

# l/д - последнее окно
bind д last-window

# w/ц - список окон
bind ц choose-window

# d/в - отключиться от сессии
bind в detach-client

# x/ч - закрыть панель
bind ч confirm-before -p "kill-pane #P? (y/n)" kill-pane

# z/я - zoom панели
bind я resize-pane -Z

# [/х - режим копирования
bind х copy-mode

# ]/ъ - вставить
bind ъ paste-buffer

# :/Ж - командная строка
bind Ж command-prompt

# ,/б - переименовать окно
bind б command-prompt -I "#W" "rename-window '%%'"

# ./ю - переместить окно
bind ю command-prompt "move-window -t '%%'"

# o/щ - следующая панель
bind щ select-pane -t :.+

# ;/ж - последняя панель
bind ж last-pane

# q/й - номера панелей
bind й display-panes

# &/? - закрыть окно (на той же клавише с shift)
bind ? confirm-before -p "kill-window #W? (y/n)" kill-window

# s/ы - список сессий
bind ы choose-tree -s

# $/; - переименовать сессию
bind \; command-prompt -I "#S" "rename-session '%%'"

# ============================================
# Сплиты (splits)
# ============================================

# Удобные биндинги (работают в любой раскладке)
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# ============================================
# Перемещение и управление панелями
# ============================================

# Поменять панели местами (Shift+стрелки - работает в любой раскладке)
bind -r S-Left swap-pane -U
bind -r S-Right swap-pane -D
bind -r S-Up swap-pane -U
bind -r S-Down swap-pane -D

# {/} и русские х/ъ - swap panes
bind -r \{ swap-pane -U
bind -r \} swap-pane -D

# Rotate panes
bind -r C-o rotate-window

# !/1 - вынести панель в отдельное окно
bind ! break-pane

# ============================================
# Vim-style навигация (hjkl + русские роьд)
# ============================================

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind р select-pane -L
bind о select-pane -D
bind л select-pane -U
bind д select-pane -R

# Ресайз с Shift+hjkl (HJKL + РОЛЬД)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

bind -r Р resize-pane -L 5
bind -r О resize-pane -D 5
bind -r Л resize-pane -U 5
bind -r Д resize-pane -R 5

# Навигация через Alt+стрелки (работает в любой раскладке)
# bind -n M-Left select-pane -L
# bind -n M-Right select-pane -R
# bind -n M-Up select-pane -U
# bind -n M-Down select-pane -D

# Переключение между окнами через Super+стрелки
# bind -n '\e[1;9D' previous-window
# bind -n '\e[1;9C' next-window
bind -n M-Left previous-window
bind -n M-Right next-window

# Изменение размера через Ctrl+стрелки
bind -n C-Left resize-pane -L 2
bind -n C-Right resize-pane -R 2
bind -n C-Up resize-pane -U 2
bind -n C-Down resize-pane -D 2

# ============================================
# Сессии
# ============================================

# (/) - предыдущая/следующая сессия
bind ( switch-client -p
bind ) switch-client -n

# L - последняя сессия
bind L switch-client -l

# ============================================
# Дополнительные полезные команды
# ============================================

# f/а - найти окно
bind f command-prompt "find-window -Z '%%'"
bind а command-prompt "find-window -Z '%%'"

# i/ш - информация об окне
bind i display-message
bind ш display-message

# t/е - показать время
bind t clock-mode
bind е clock-mode

# Space - переключить layout
bind Space next-layout

# = - выровнять панели (tiled)
bind = select-layout tiled

# m/ь - отметить панель
bind m select-pane -m
bind ь select-pane -m

# M/Ь - присоединить отмеченную панель сюда
bind M join-pane
bind Ь join-pane

# r/к - перезагрузить конфиг
bind r source-file ~/.tmux.conf \; display "Config reloaded!"
bind к source-file ~/.tmux.conf \; display "Конфиг перезагружен!"

# ============================================
# Tmux Themepack - Powerline Cyan Block
# ============================================

# Themepack format options
# set -goq @themepack-status-left-area-left-format "#S"
# set -goq @themepack-status-left-area-middle-format "#(whoami)"
# set -goq @themepack-status-left-area-right-format "#I:#P"
set -goq @themepack-status-right-area-left-format "%H:%M:%S"
set -goq @themepack-status-right-area-middle-format "%d-%b-%y"
set -goq @themepack-status-right-area-right-format "#H"
set -goq @themepack-window-status-current-format "#I:#W#F"
set -goq @themepack-window-status-format "#I:#W#F"

# Customizable prefixes and suffixes for @themepack-* format options
set -goq @themepack-status-left-area-left-prefix ""
set -goq @themepack-status-left-area-left-suffix ""
set -goq @themepack-status-left-area-middle-prefix ""
set -goq @themepack-status-left-area-middle-suffix ""
set -goq @themepack-status-left-area-right-prefix ""
set -goq @themepack-status-left-area-right-suffix ""
set -goq @themepack-status-right-area-left-prefix ""
set -goq @themepack-status-right-area-left-suffix ""
set -goq @themepack-status-right-area-middle-prefix ""
set -goq @themepack-status-right-area-middle-suffix ""
set -goq @themepack-status-right-area-right-prefix ""
set -goq @themepack-status-right-area-right-suffix ""
set -goq @themepack-window-status-current-prefix ""
set -goq @themepack-window-status-current-suffix ""
set -goq @themepack-window-status-prefix ""
set -goq @themepack-window-status-suffix ""

# Apply prefixes and suffixes to @themepack-* format options
set -gqF @themepack-status-left-area-left-format "#{@themepack-status-left-area-left-prefix}#{@themepack-status-left-area-left-format}#{@themepack-status-left-area-left-suffix}"
set -gqF @themepack-status-left-area-middle-format "#{@themepack-status-left-area-middle-prefix}#{@themepack-status-left-area-middle-format}#{@themepack-status-left-area-middle-suffix}"
set -gqF @themepack-status-left-area-right-format "#{@themepack-status-left-area-right-prefix}#{@themepack-status-left-area-right-format}#{@themepack-status-left-area-right-suffix}"
set -gqF @themepack-status-right-area-left-format "#{@themepack-status-right-area-left-prefix}#{@themepack-status-right-area-left-format}#{@themepack-status-right-area-left-suffix}"
set -gqF @themepack-status-right-area-middle-format "#{@themepack-status-right-area-middle-prefix}#{@themepack-status-right-area-middle-format}#{@themepack-status-right-area-middle-suffix}"
set -gqF @themepack-status-right-area-right-format "#{@themepack-status-right-area-right-prefix}#{@themepack-status-right-area-right-format}#{@themepack-status-right-area-right-suffix}"
set -gqF @themepack-window-status-current-format "#{@themepack-window-status-current-prefix}#{@themepack-window-status-current-format}#{@themepack-window-status-current-suffix}"
set -gqF @themepack-window-status-format "#{@themepack-window-status-prefix}#{@themepack-window-status-format}#{@themepack-window-status-suffix}"

# Powerline color options
set -goq @powerline-color-main-1 colour39
set -goq @powerline-color-main-2 colour81
set -goq @powerline-color-main-3 colour75
set -goq @powerline-color-black-1 black
set -goq @powerline-color-grey-1 colour233
set -goq @powerline-color-grey-2 colour235
set -goq @powerline-color-grey-3 colour238
set -goq @powerline-color-grey-4 colour240
set -goq @powerline-color-grey-5 colour243
set -goq @powerline-color-grey-6 colour245

# Powerline Block Override
set -goqF @powerline-color-activity-1 "#{@powerline-color-main-3}"

# Powerline options
set -goqF @powerline-color-activity-1 "#{@powerline-color-grey-6}"
set -goqF @powerline-status-bg "#{@powerline-color-grey-1}"
set -goqF @powerline-status-fg "#{@powerline-color-grey-4}"
set -goqF @powerline-status-left-area-left-bg "#{@powerline-color-main-1}"
set -goqF @powerline-status-left-area-left-fg "#{@powerline-status-bg}"
set -goqF @powerline-status-left-area-middle-bg "#{@powerline-status-fg}"
set -goqF @powerline-status-left-area-middle-fg "#{@powerline-status-bg}"
set -goqF @powerline-status-left-area-right-bg "#{@powerline-color-grey-2}"
set -goqF @powerline-status-left-area-right-fg "#{@powerline-status-fg}"
set -goqF @powerline-status-left-bg "#{@powerline-color-grey-1}"
set -goqF @powerline-status-left-fg "#{@powerline-color-grey-5}"
set -goqF @powerline-status-right-area-left-bg "#{@powerline-color-grey-2}"
set -goqF @powerline-status-right-area-left-fg "#{@powerline-status-fg}"
set -goqF @powerline-status-right-area-middle-bg "#{@powerline-status-fg}"
set -goqF @powerline-status-right-area-middle-fg "#{@powerline-status-bg}"
set -goqF @powerline-status-right-area-right-bg "#{@powerline-color-grey-6}"
set -goqF @powerline-status-right-area-right-fg "#{@powerline-status-bg}"
set -goqF @powerline-status-right-bg "#{@powerline-color-grey-1}"
set -goqF @powerline-status-right-fg "#{@powerline-color-grey-5}"

# Theme options
set -goqF @theme-clock-mode-colour "#{@powerline-color-main-1}"
set -goq  @theme-clock-mode-style 24
set -goqF @theme-display-panes-active-colour "#{@powerline-color-grey-6}"
set -goqF @theme-display-panes-colour "#{@powerline-color-grey-1}"
set -goqF @theme-message-bg "#{@powerline-color-main-1}"
set -goqF @theme-message-command-bg "#{@powerline-color-main-1}"
set -goqF @theme-message-command-fg "#{@powerline-color-black-1}"
set -goqF @theme-message-fg "#{@powerline-color-black-1}"
set -goqF @theme-mode-bg "#{@powerline-color-main-1}"
set -goqF @theme-mode-fg "#{@powerline-color-black-1}"
set -goq  @theme-pane-active-border-bg default
set -goqF @theme-pane-active-border-fg "#{@powerline-color-main-1}"
set -goq  @theme-pane-border-bg default
set -goqF @theme-pane-border-fg "#{@powerline-color-grey-3}"
set -goqF @theme-status-bg "#{@powerline-status-bg}"
set -goqF @theme-status-fg "#{@powerline-status-fg}"
set -goq  @theme-status-interval 1
set -goq  @theme-status-justify left
set -goqF @theme-status-left ""
set -goqF @theme-status-left-bg "#{@powerline-status-left-bg}"
set -goqF @theme-status-left-fg "#{@powerline-status-left-fg}"
set -goq  @theme-status-left-length 0
set -goqF @theme-status-right "#[fg=#{@powerline-status-right-area-left-bg},bg=#{@theme-status-bg}]#[fg=#{@powerline-status-right-area-left-fg},bg=#{@powerline-status-right-area-left-bg}] #{@themepack-status-right-area-left-format} #[fg=#{@powerline-status-right-area-middle-bg},bg=#{@powerline-status-right-area-left-bg}]#[fg=#{@powerline-status-right-area-middle-fg},bg=#{@powerline-status-right-area-middle-bg}] #{@themepack-status-right-area-middle-format} #[fg=#{@powerline-status-right-area-right-bg},bg=#{@powerline-status-right-area-middle-bg}]#[fg=#{@powerline-status-right-area-right-fg},bg=#{@powerline-status-right-area-right-bg},bold] #{@themepack-status-right-area-right-format} "
set -goqF @theme-status-right-bg "#{@powerline-status-right-bg}"
set -goqF @theme-status-right-fg "#{@powerline-status-right-fg}"
set -goq  @theme-status-right-length 150
set -goqF @theme-window-status-activity-bg "#{@theme-status-bg}"
set -goqF @theme-window-status-activity-fg "#{@powerline-color-activity-1}"
set -goq  @theme-window-status-separator ""
set -goqF @theme-window-status-current-bg "#{@powerline-color-main-1}"
set -goqF @theme-window-status-current-fg "#{@powerline-color-black-1}"
set -goqF @theme-window-status-format " #{@themepack-window-status-format} "
set -goqF @theme-window-status-current-format " #{@themepack-window-status-current-format} "

# Customizable prefixes and suffixes for @theme-* format options
set -goq @theme-status-left-prefix ""
set -goq @theme-status-left-suffix ""
set -goq @theme-status-right-prefix ""
set -goq @theme-status-right-suffix ""
set -goq @theme-window-status-current-prefix ""
set -goq @theme-window-status-current-suffix ""
set -goq @theme-window-status-prefix ""
set -goq @theme-window-status-suffix ""

# Apply prefixes and suffixes to @theme-* format options
set -gqF @theme-status-left "#{@theme-status-left-prefix}#{@theme-status-left}#{@theme-status-left-suffix}"
set -gqF @theme-status-right "#{@theme-status-right-prefix}#{@theme-status-right}#{@theme-status-right-suffix}"
set -gqF @theme-window-status-current-format "#{@theme-window-status-current-prefix}#{@theme-window-status-current-format}#{@theme-window-status-current-suffix}"
set -gqF @theme-window-status-format "#{@theme-window-status-prefix}#{@theme-window-status-format}#{@theme-window-status-suffix}"

# Apply @theme-* options to Tmux
set -gF  display-panes-active-colour "#{@theme-display-panes-active-colour}"
set -gF  display-panes-colour "#{@theme-display-panes-colour}"
set -gF  message-command-style "fg=#{@theme-message-command-fg},bg=#{@theme-message-command-bg}"
set -gF  message-style "fg=#{@theme-message-fg},bg=#{@theme-message-bg}"
set -gF  status-interval "#{@theme-status-interval}"
set -gF  status-justify "#{@theme-status-justify}"
set -gF  status-left "#{@theme-status-left}"
set -gF  status-left-length "#{@theme-status-left-length}"
set -gF  status-left-style "fg=#{@theme-status-left-fg},bg=#{@theme-status-left-bg}"
set -gF  status-right "#{@theme-status-right}"
set -gF  status-right-length "#{@theme-status-right-length}"
set -gF  status-right-style "fg=#{@theme-status-right-fg},bg=#{@theme-status-right-bg}"
set -gF  status-style "fg=#{@theme-status-fg},bg=#{@theme-status-bg}"
set -gwF clock-mode-colour "#{@theme-clock-mode-colour}"
set -gwF clock-mode-style "#{@theme-clock-mode-style}"
set -gwF mode-style "fg=#{@theme-mode-fg},bg=#{@theme-mode-bg}"
set -gwF pane-active-border-style "fg=#{@theme-pane-active-border-fg},bg=#{@theme-pane-active-border-bg}"
set -gwF pane-border-style "fg=#{@theme-pane-border-fg},bg=#{@theme-pane-border-bg}"
set -gwF window-status-activity-style "fg=#{@theme-window-status-activity-fg},bg=#{@theme-window-status-activity-bg}"
set -gwF window-status-current-format "#{@theme-window-status-current-format}"
set -gwF window-status-current-style "fg=#{@theme-window-status-current-fg},bg=#{@theme-window-status-current-bg}"
set -gwF window-status-format "#{@theme-window-status-format}"
set -gwF window-status-separator "#{@theme-window-status-separator}"


###############################################
set-option -g status-position top

# Жирные названия табов (окон) с сохранением цветов темы
set -gwF window-status-current-style "fg=colour16,bg=#{@theme-window-status-current-bg},bold"
set -gwF window-status-style "fg=#{@theme-status-fg},bg=#{@theme-status-bg},bold"

# Серая разделительная линия под статусной строкой
# set -g pane-border-style fg=colour240,bg=default
# set -g pane-active-border-style fg=colour240,bg=default
# set -g pane-border-lines single
# set -g pane-border-status top 
# set -g pane-border-format ""

# ============================================
# Кастомизация статусной строки - CPU и RAM
# ============================================

# Обновлять статус каждые 2 секунды
set -g status-interval 2

# Добавить CPU и RAM в правую часть статусной строки
set -g status-right-length 150
set -g status-right "#[fg=colour245,bg=colour233,bold] CPU: #(top -bn1 | grep 'Cpu(s)' | awk '{print 100-$8\"%\"}' | sed 's/\\.[0-9]*%/%/')   MEM: #(free | grep Mem | awk '{printf \"%.0f%%\", $3/$2 * 100.0}')   %d/%m %H:%M "
